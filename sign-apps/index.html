<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K√Ω iOS App v·ªõi P12 - H∆∞·ªõng d·∫´n chi ti·∫øt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin: 30px auto;
            padding: 30px;
        }
        .step-number {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s;
        }
        .file-upload-area:hover {
            background: #eef2ff;
            border-color: #764ba2;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Header -->
                <div class="text-center text-white mb-5">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="fas fa-mobile-alt me-3"></i>
                        K√Ω iOS App Online
                    </h1>
                    <p class="lead">K√Ω ·ª©ng d·ª•ng iOS v·ªõi file P12 v√† mobileprovision c·ªßa b·∫°n</p>
                </div>

                <!-- Main Card -->
                <div class="main-card">
                    <!-- H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc -->
                    <div class="mb-4">
                        <h4><i class="fas fa-info-circle me-2 text-primary"></i>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</h4>
                        <div class="ps-3">
                            <p class="mb-2"><span class="step-number">1</span> Chu·∫©n b·ªã file P12 v√† mobileprovision</p>
                            <p class="mb-2"><span class="step-number">2</span> Ch·ªçn ·ª©ng d·ª•ng c·∫ßn k√Ω</p>
                            <p class="mb-2"><span class="step-number">3</span> Upload file v√† nh·∫≠p m·∫≠t kh·∫©u</p>
                            <p class="mb-2"><span class="step-number">4</span> Nh·∫•n "K√Ω ·ª®ng D·ª•ng" v√† ch·ªù x·ª≠ l√Ω</p>
                            <p class="mb-0"><span class="step-number">5</span> B·∫•m "C√†i ƒê·∫∑t Ngay" ƒë·ªÉ c√†i app l√™n iPhone</p>
                        </div>
                    </div>

                    <hr>

                    <!-- Form k√Ω app -->
                    <form id="signForm" enctype="multipart/form-data">
                        <!-- B∆∞·ªõc 1: Ch·ªçn ·ª©ng d·ª•ng -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5">
                                <i class="fas fa-box me-2"></i>B∆∞·ªõc 1: Ch·ªçn ·ª©ng d·ª•ng c·∫ßn k√Ω
                            </label>
                            <select class="form-select form-select-lg" name="ipa_name" required>
                                <option value="Esign.ipa">üì± Esign - App k√Ω ·ª©ng d·ª•ng</option>
                                <option value="GBox.ipa">üéÆ GBox - Game platform</option>
                                <option value="Scarlet.ipa">üî¥ Scarlet - App installer</option>
                                <option value="Zsign.ipa">‚úçÔ∏è Zsign - Signing tool</option>
                            </select>
                            <div class="form-text">Ch·ªçn ·ª©ng d·ª•ng b·∫°n mu·ªën k√Ω v√† c√†i ƒë·∫∑t</div>
                        </div>

                        <!-- B∆∞·ªõc 2: Upload file P12 -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5">
                                <i class="fas fa-file-certificate me-2"></i>B∆∞·ªõc 2: Upload file ch·ª©ng ch·ªâ
                            </label>
                            <div class="file-upload-area">
                                <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                <h5>K√©o th·∫£ file P12 v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</h5>
                                <p class="text-muted">Ch·ªçn file ch·ª©ng ch·ªâ .p12 c·ªßa b·∫°n</p>
                                <input type="file" class="form-control d-none" id="p12File" name="p12" accept=".p12" required>
                                <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('p12File').click()">
                                    <i class="fas fa-folder-open me-2"></i>Ch·ªçn File P12
                                </button>
                                <div id="p12FileName" class="mt-2 text-success fw-bold"></div>
                            </div>
                        </div>

                        <!-- B∆∞·ªõc 3: Upload mobileprovision -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5">
                                <i class="fas fa-file-contract me-2"></i>B∆∞·ªõc 3: Upload file provisioning
                            </label>
                            <div class="file-upload-area">
                                <i class="fas fa-file-alt fa-3x text-primary mb-3"></i>
                                <h5>K√©o th·∫£ file mobileprovision v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</h5>
                                <p class="text-muted">Ch·ªçn file .mobileprovision c·ªßa b·∫°n</p>
                                <input type="file" class="form-control d-none" id="mobileprovisionFile" name="mobileprovision" accept=".mobileprovision" required>
                                <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('mobileprovisionFile').click()">
                                    <i class="fas fa-folder-open me-2"></i>Ch·ªçn File Mobileprovision
                                </button>
                                <div id="mobileprovisionFileName" class="mt-2 text-success fw-bold"></div>
                            </div>
                        </div>

                        <!-- B∆∞·ªõc 4: Nh·∫≠p m·∫≠t kh·∫©u -->
                        <div class="mb-4">
                            <label class="form-label fw-bold fs-5">
                                <i class="fas fa-lock me-2"></i>B∆∞·ªõc 4: Nh·∫≠p m·∫≠t kh·∫©u P12
                            </label>
                            <div class="input-group input-group-lg">
                                <input type="password" class="form-control" name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u file P12..." required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">M·∫≠t kh·∫©u n√†y ƒë∆∞·ª£c ƒë·∫∑t khi export file P12 t·ª´ Keychain Access</div>
                        </div>

                        <!-- N√∫t submit -->
                        <button type="submit" class="btn btn-primary w-100 py-3 fs-5">
                            <i class="fas fa-signature me-2"></i>K√ù ·ª®NG D·ª§NG NGAY
                        </button>
                    </form>

                    <!-- K·∫øt qu·∫£ -->
                    <div id="resultSection" class="mt-4" style="display: none;">
                        <div class="alert alert-success border-0">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle fa-2x me-3"></i>
                                <div>
                                    <h4 class="alert-heading mb-2">‚úÖ K√Ω th√†nh c√¥ng!</h4>
                                    <p class="mb-3">·ª®ng d·ª•ng ƒë√£ ƒë∆∞·ª£c k√Ω th√†nh c√¥ng. Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ c√†i ƒë·∫∑t l√™n iPhone:</p>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <a href="#" id="installBtn" class="btn btn-success btn-lg px-5">
                                    <i class="fas fa-download me-2"></i>C√ÄI ƒê·∫∂T NGAY
                                </a>
                                <p class="mt-3 small text-muted">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    <strong>L∆∞u √Ω:</strong> Link s·∫Ω t·ª± ƒë·ªông h·∫øt h·∫°n sau 15 ph√∫t
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin b·ªï sung -->
                <div class="main-card mt-4">
                    <h5><i class="fas fa-question-circle me-2 text-primary"></i>C√¢u h·ªèi th∆∞·ªùng g·∫∑p</h5>
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    L√†m th·∫ø n√†o ƒë·ªÉ l·∫•y file P12 v√† mobileprovision?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    B·∫°n c·∫ßn c√≥ t√†i kho·∫£n Apple Developer ($99/nƒÉm). Export certificate t·ª´ Keychain Access tr√™n Mac v√† download mobileprovision t·ª´ Apple Developer Portal.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    T·∫°i sao c·∫ßn SSL cho website?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    iOS y√™u c·∫ßu HTTPS ƒë·ªÉ download app OTA. B·∫°n c√≥ th·ªÉ d√πng Cloudflare Free SSL ho·∫∑c Let's Encrypt.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    $(document).ready(function() {
        // Hi·ªÉn th·ªã t√™n file khi ch·ªçn
        $('#p12File').change(function() {
            if (this.files.length > 0) {
                $('#p12FileName').html('<i class="fas fa-check me-2"></i>' + this.files[0].name);
            }
        });

        $('#mobileprovisionFile').change(function() {
            if (this.files.length > 0) {
                $('#mobileprovisionFileName').html('<i class="fas fa-check me-2"></i>' + this.files[0].name);
            }
        });

        // Toggle password visibility
        $('#togglePassword').click(function() {
            const passwordField = $('input[name="password"]');
            const type = passwordField.attr('type') === 'password' ? 'text' : 'password';
            passwordField.attr('type', type);
            $(this).find('i').toggleClass('fa-eye fa-eye-slash');
        });

        // X·ª≠ l√Ω form submit
        $('#signForm').on('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // Validate
            if (!formData.get('p12').name || !formData.get('mobileprovision').name) {
                Swal.fire('L·ªói', 'Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß file P12 v√† mobileprovision', 'error');
                return;
            }

            // Hi·ªÉn th·ªã loading
            Swal.fire({
                title: 'ƒêang k√Ω ·ª©ng d·ª•ng...',
                html: `
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;"></div>
                        <p>Qu√° tr√¨nh n√†y c√≥ th·ªÉ m·∫•t 1-3 ph√∫t</p>
                        <small class="text-muted">ƒêang x·ª≠ l√Ω file v√† k√Ω ·ª©ng d·ª•ng...</small>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false
            });

            // G·ª≠i request ƒë·∫øn backend
            $.ajax({
                url: 'sign_app.php',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    Swal.close();
                    
                    if (response.success) {
                        // Hi·ªÉn th·ªã k·∫øt qu·∫£ th√†nh c√¥ng
                        $('#installBtn').attr('href', response.download_url);
                        $('#resultSection').show();
                        
                        // Cu·ªôn ƒë·∫øn k·∫øt qu·∫£
                        $('html, body').animate({
                            scrollTop: $('#resultSection').offset().top - 100
                        }, 500);
                        
                        Swal.fire({
                            title: 'Th√†nh c√¥ng!',
                            text: '·ª®ng d·ª•ng ƒë√£ ƒë∆∞·ª£c k√Ω th√†nh c√¥ng',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                    } else {
                        Swal.fire('L·ªói!', response.message || 'C√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh k√Ω', 'error');
                    }
                },
                error: function(xhr, status, error) {
                    Swal.close();
                    Swal.fire('L·ªói k·∫øt n·ªëi!', 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server: ' + error, 'error');
                }
            });
        });

        // X·ª≠ l√Ω n√∫t c√†i ƒë·∫∑t
        $('#installBtn').on('click', function(e) {
            const installUrl = $(this).attr('href');
            if (installUrl && installUrl.startsWith('itms-services://')) {
                // M·ªü itms-services URL ƒë·ªÉ c√†i ƒë·∫∑t app
                window.location.href = installUrl;
                
                Swal.fire({
                    title: 'ƒêang chuy·ªÉn h∆∞·ªõng...',
                    text: 'iOS s·∫Ω m·ªü v√† b·∫Øt ƒë·∫ßu c√†i ƒë·∫∑t ·ª©ng d·ª•ng',
                    icon: 'info',
                    timer: 3000,
                    showConfirmButton: false
                });
            }
        });
    });
    </script>
</body>
</html>
